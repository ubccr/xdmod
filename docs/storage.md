---
title: Storage (Alpha)
---

**NOTE: Storage metrics are currently considered alpha quality.**

## Setup

Create storage database and grant permissions.  Use the same username and
password as is used in `datawarehouse` section of `portal_settings.ini`:

NOTE: database tables are dynamically generated by the ETL process.

```mysql
CREATE DATABASE modw_storage;
GRANT ALL ON modw_storage.* TO 'username'@'localhost' IDENTIFIED BY 'password';
```

Add storage query descripters to public (or another) role in `roles.json`:

Note: these changes must be made directly to `roles.json` and not added to
separate file in `roles.d`.

```json
{
    "roles": {
        "pub": {

            ...

            "query_descripters": [

                ...

                {
                    "realm": "Storage",
                    "group_by": "none"
                },
                {
                    "realm": "Storage",
                    "group_by": "username"
                },
                {
                    "realm": "Storage",
                    "group_by": "file_system"
                },
                {
                    "realm": "Storage",
                    "group_by": "directory"
                }
            ]
        }
    }
}
```

Update ACL:

```
$ acl-import
```

## Input Format

Copy data to `/etc/xdmod/etl/etl_data.d/storage/user_usage.json`.

NOTE: The thresholds and usage numbers are all measured in bytes.  Directory
names are currently limited to 255 characters.

```json
[
    {
        "file_system": "nfs",
        "directory": "/home",
        "username": "jdoe",
        "dt": "2017-01-01T00:00:00",
        "soft_threshold": 1000000,
        "hard_threshold": 1200000,
        "file_count": 10000,
        "logical_usage": 100000,
        "physical_usage": 100000
    },

    ...
]
```

## ETL Commands

Ingest data:

```
/usr/share/xdmod/tools/etl/etl_overseer.php \
    -a xdmod.storage.StorageFileSystemIngestor \
    -a xdmod.storage.StorageUserIngestor \
    -a xdmod.storage.StorageDirectoryIngestor \
    -a xdmod.storage.StorageUserUsageIngestor
```

Aggregate data:

```
/usr/share/xdmod/tools/etl/etl_overseer.php \
    -a xdmod.storage.StorageUserUsageAggregator
```
