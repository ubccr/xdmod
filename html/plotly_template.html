<!DOCTYPE HTML>
<html lang="en">
    <head>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Plotly Template</title>

        <style type="text/css">html,body{margin:0px;height:100%;}</style>
        <script type="text/javascript" src="_html_dir_/gui/lib/jquery/jquery-1.12.4.min.js"></script>
        <script type="text/javascript" src="_html_dir_/gui/js/StringExtensions.js"></script>

        <script type="text/javascript" src="_html_dir_/gui/lib/moment/moment.min.js"></script>
        <script type="text/javascript" src="_html_dir_/gui/lib/moment-timezone/moment-timezone-with-data.min.js"></script>
        <script type="text/javascript" src="_html_dir_/gui/lib/plotly/plotly-2.24.2.min.js"></script>

        <script type="text/javascript" src="_html_dir_/gui/js/libraries/PlotlyUtilities.js"></script>
        <script type="text/javascript" src="_html_dir_/gui/js/CCR.js"></script>

    </head>

    <body>

        <div id="container" class="plotly"></div>
        <script type="text/javascript">
        var Ext = {
            namespace: function () {}
        };
        var XDMoD = {
            utils: {}
        };
        $(document).ready(function () {
        // _ chartOptions _ is a macro that is substituted by \xd_charting\exportHighchart()
        var inputChartOptions = _chartOptions_;
        var args = {
            mainTitleFontSize: inputChartOptions.chartTitleSize,
            axisTitleFontSize: inputChartOptions.axisTitleSize,
            axisLabelFontSize: inputChartOptions.axisTickSize,
            lineWidth: inputChartOptions.lineWidth
            };
        var chartOptions = {};
        // Chart will be fully configured if export call came from non-supremm module tab
        if (inputChartOptions.layout) {
            chartOptions = inputChartOptions;
            if (chartOptions.layout.annotations && chartOptions.layout.annotations.length > 0) {
                chartOptions.layout.annotations[2].yshift = (_height_ - chartOptions.layout.margin.t) * -1;
                chartOptions.layout.annotations[2].xshift = chartOptions.layout.margin.r - 20;
            }
            // Update chart layout with export settings
            chartOptions.layout.annotations[0].font['size'] = args.mainTitleFontSize;
            chartOptions.layout.legend.x = 0.5;
            chartOptions.layout.legend.y = 0.0;
            let multiAxes = getMultiAxisObjects(chartOptions.layout);

            for (let i = 0; i < multiAxes.length; i++) {
                const axis = chartOptions.layout[`${multiAxes[i]}`];
                if (axis.title && axis.tickfont) {
                    axis.title.font.size = args.axisTitleFontSize;
                    axis.tickfont = args.LabelFontSize;
                }
            }

            if (chartOptions.layout.swapXY) {
                if (chartOptions.layout.yaxis && chartOptions.layout.yaxis.title && chartOptions.layout.yaxis.tickfont) {
                    chartOptions.layout.yaxis.title.font.size = args.axisTitleFontSize;
                    chartOptions.layout.yaxis.tickfont.size = args.LabelFontSize;
                }
            }
            else {
                if (chartOptions.layout.xaxis && chartOptions.layout.xaxis.title && chartOptions.layout.xaxis.tickfont) {
                    chartOptions.layout.xaxis.title.font.size = args.axisTitleFontSize;
                    chartOptions.layout.xaxis.tickfont.size = args.LabelFontSize;
                }
            }
            // Loop through data to adjust line width
            for (let i = 0; i < chartOptions.data.length; i++) {
                chartOptions.data[i]['line']['width'] = args.lineWidth;
                // Svg legend names clip for some reason so we need to word wrap
            }
        }
        else {
            chartOptions = generateChartOptions(inputChartOptions, args);
        }

        chartOptions.layout['width'] = _width_;
        chartOptions.layout['height'] = _height_;

        Plotly.newPlot('container', chartOptions.data, chartOptions.layout, { staticPlot: true } );
        });

        </script>

    </body>
</html>
