services:
    xdmod:
        image: tools-ext-01.ccr.xdmod.org/xdmod:x86_64-rockylinux8.10.20240528-v11.0.2-3-01
        container_name: xdmod
        hostname: xdmod
        networks:
            - xdmod_default
        shm_size: 2g
        init: true
        ports:
            - 9006:443
            - 7000:7000
        volumes:
          - ./xdmod/root/bin/services:/root/bin/services
          - ./xdmod/root/my.cnf:/root/.my.cnf:ro
        environment:
            XDMOD_REALMS: 'jobs,storage,cloud,resourcespecifications'
            XDMOD_IS_CORE: true
        stdin_open: true
        tty: true
        command: sleep infinity
    mariadb:
      image: mariadb:10.3.39
      container_name: mariadb
      hostname: mariadb
      networks:
        - xdmod_default
      environment:
        MARIADB_ALLOW_EMPTY_ROOT_PASSWORD: true
      volumes:
        - ./mariadb/etc/mysql/mariadb.conf.d/05-skipcache.cnf:/etc/mysql/mariadb.conf.d/05-skipcache.cnf:ro
      ports:
        - "3306:3306"
    playwright:
        image:  mcr.microsoft.com/playwright:v1.56.1-jammy
        hostname: playwright
        container_name: playwright
        networks:
            - xdmod_default
        stdin_open: true
        tty: true
        ipc: host
        links:
            - xdmod
        depends_on:
            - xdmod
        environment:
            BASE_URL: https://xdmod
            XDMOD_REALMS: 'jobs,storage,cloud,resourcespecifications'
        command: sleep infinity
networks:
  xdmod_default:
