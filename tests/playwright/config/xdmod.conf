<VirtualHost *:443>
    # The ServerName and ServerAdmin parameters should be updated.
    ServerName localhost
    ServerAdmin postmaster@localhost

    # Production Open XDMoD instances should use HTTPS
    SSLEngine on
    SSLProtocol all -SSLv2 -SSLv3

    # Update the SSLCertificateFile and SSLCertificateKeyFile parameters
    # to the correct paths to your SSL certificate.
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>

    # Use HTTP Strict Transport Security to force client to use secure connections only
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    DocumentRoot /usr/share/xdmod/html

    <Directory /usr/share/xdmod/html>
        Options FollowSymLinks
        AllowOverride All
        DirectoryIndex index.php

        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>

    <Directory /usr/share/xdmod/html/rest>
        RewriteEngine On
        RewriteRule (.*) index.php [L]
    </Directory>

    ## SimpleSAML Single Sign On authentication.
    SetEnv SIMPLESAMLPHP_CONFIG_DIR /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/config
    Alias /simplesaml /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/www
    <Directory /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/www>
        Options FollowSymLinks
        AllowOverride All
        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>

    Alias /symfony /usr/share/xdmod/public
    <Directory /usr/share/xdmod/public>
        Options FollowSymLinks
        AllowOverride All
        RewriteEngine On
        RewriteRule (.*) index.php [L]
        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>
    # Update the path to rotatelogs if it is different on your system.
    ErrorLog "|/usr/sbin/rotatelogs -n 5 /var/log/xdmod/apache-error.log 1M"
    CustomLog "|/usr/sbin/rotatelogs -n 5 /var/log/xdmod/apache-access.log 1M" combined
</VirtualHost>
<VirtualHost *:443>
    # The ServerName and ServerAdmin parameters should be updated.
    ServerName xdmod
    ServerAdmin postmaster@localhost

    # Production Open XDMoD instances should use HTTPS
    SSLEngine on
    SSLProtocol all -SSLv2 -SSLv3

    # Update the SSLCertificateFile and SSLCertificateKeyFile parameters
    # to the correct paths to your SSL certificate.
    SSLCertificateFile /etc/pki/tls/certs/localhost.crt
    SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
        SSLOptions +StdEnvVars
    </FilesMatch>

    # Use HTTP Strict Transport Security to force client to use secure connections only
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    DocumentRoot /usr/share/xdmod/html

    <Directory /usr/share/xdmod/html>
        Options FollowSymLinks
        AllowOverride All
        DirectoryIndex index.php

        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>

    <Directory /usr/share/xdmod/html/rest>
        RewriteEngine On
        RewriteRule (.*) index.php [L]
    </Directory>

    ## SimpleSAML Single Sign On authentication.
    SetEnv SIMPLESAMLPHP_CONFIG_DIR /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/config
    Alias /simplesaml /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/www
    <Directory /usr/share/xdmod/vendor/simplesamlphp/simplesamlphp/www>
        Options FollowSymLinks
        AllowOverride All
        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>

    Alias /symfony /usr/share/xdmod/public
    <Directory /usr/share/xdmod/public>
        Options FollowSymLinks
        AllowOverride All
        RewriteEngine On
        RewriteRule (.*) index.php [L]
        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Directory>
    # Update the path to rotatelogs if it is different on your system.
    ErrorLog "|/usr/sbin/rotatelogs -n 5 /var/log/xdmod/apache-error.log 1M"
    CustomLog "|/usr/sbin/rotatelogs -n 5 /var/log/xdmod/apache-access.log 1M" combined
</VirtualHost>
