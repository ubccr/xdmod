language: none
build:
    cache: true
    cache_dir_list:
        - /root/.composer
    pre_ci_boot:
        image_name: tas-tools-ext-01.ccr.xdmod.org/centos7-xdmod6.6.0
        image_tag: version3
        pull: true
        options: "--user root -e HOME=/root"
    ci:
        - composer install
        - ~/bin/buildrpm xdmod
        - rpm -Uvh --oldpackage ~/rpmbuild/RPMS/*/*.rpm
        - ~/bin/services start
        - xdmod-upgrade --batch-mode | col -bx
        - cp ~/assets/secrets open_xdmod/modules/xdmod/integration_tests/.secrets
        - composer --dev install
        - ./open_xdmod/modules/xdmod/integration_tests/runtests.sh --log-junit `pwd`/shippable/testresults/results.xml
