120a121,141
>     }
> 
> 
>     /**
>      * Verify that a given URL is valid.
>      *
>      * @param string $url The URL we want to verify.
>      *
>      * @return boolean True if the given URL is valid, false otherwise.
>      */
>     public static function isValidURL($url)
>     {
>         $url = filter_var($url, FILTER_VALIDATE_URL);
>         if ($url === false) {
>             return false;
>         }
>         $scheme = parse_url($url, PHP_URL_SCHEME);
>         if ($scheme !== false && in_array(strtolower($scheme), ['http', 'https'], true)) {
>             return true;
>         }
>         return false;
150a172,174
>         }
>         if (!self::isValidURL($url)) {
>             throw new \SimpleSAML_Error_Exception('Invalid destination URL.');
151a176
> 
328c353
<         if (filter_var($url, FILTER_VALIDATE_URL) === false) {
---
>         if (!self::isValidURL($url)) {
1206a1232,1234
>         if (!self::isValidURL($destination)) {
>             throw new \SimpleSAML_Error_Exception('Invalid destination URL.');
>         }

